@inject ISecurityService SecurityService

<div class="lock-screen">
    <div class="lock-container">
<<<<<<< Updated upstream
        <h2 class="mb-4">Welcome back, @Username</h2>
        <p class="text-muted mb-4">Enter your PIN to unlock</p>
=======
        <h2 class="mb-4">Login</h2>
        <p class="mb-4">Enter your credentials</p>
>>>>>>> Stashed changes
        
        <div class="mb-3">
            <label class="form-label">Username</label>
            <input type="text" 
                   class="form-control" 
                   @bind="UsernameInput" 
                   placeholder="Enter username" />
        </div>

        <div class="pin-input-container mb-3">
            <label class="form-label">PIN</label>
            <input type="password" 
                   class="form-control text-center pin-input" 
                   @bind="PinInput" 
                   @bind:event="oninput"
                   @onkeyup="HandleKeyUp"
                   placeholder="Enter PIN"
                   maxlength="6" />
        </div>

        @if (!string.IsNullOrEmpty(ErrorMessage))
        {
            <div class="alert alert-danger py-2 mb-3">@ErrorMessage</div>
        }

        <button class="btn btn-dark w-100 mb-2" @onclick="LoginApp">Login</button>
        
        <button class="btn btn-outline-secondary w-100" @onclick="GoToSignup">
            Don't have an account? Sign Up
        </button>
    </div>
</div>

<style>
    .lock-screen {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
<<<<<<< Updated upstream
=======
        transition: background 0.3s;
    }

    body.theme-light .lock-screen {
        background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
    }

    body.theme-dark .lock-screen {
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
>>>>>>> Stashed changes
    }

    .lock-container {
        background: #ffffff;
        padding: 3rem;
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        width: 100%;
        max-width: 400px;
<<<<<<< Updated upstream
=======
        transition: background 0.3s, color 0.3s;
    }

    body.theme-light .lock-container {
        background: #ffffff;
        color: #000000;
    }

    body.theme-dark .lock-container {
        background: #2d2d2d;
        color: #ffffff;
>>>>>>> Stashed changes
    }

    .form-label {
        font-weight: 500;
        margin-bottom: 0.5rem;
    }

    .pin-input {
        font-size: 1.5rem;
        letter-spacing: 0.5rem;
        height: 60px;
    }
</style>

@code {
    private string UsernameInput { get; set; } = "";
    private string PinInput { get; set; } = "";
    private string ErrorMessage { get; set; } = "";

    [Parameter]
    public EventCallback OnUnlocked { get; set; }

    [Parameter]
    public EventCallback OnGoToSignup { get; set; }

    private async Task HandleKeyUp(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            await LoginApp();
        }
    }

    private async Task LoginApp()
    {
        ErrorMessage = "";

        if (string.IsNullOrWhiteSpace(UsernameInput))
        {
            ErrorMessage = "Please enter your username";
            return;
        }

        if (string.IsNullOrWhiteSpace(PinInput))
        {
            ErrorMessage = "Please enter your PIN";
            return;
        }

        var success = await SecurityService.LoginAsync(UsernameInput, PinInput);

        if (success)
        {
            await SecurityService.UnlockApp();
            await OnUnlocked.InvokeAsync();
        }
        else
        {
            ErrorMessage = "Invalid username or PIN";
            PinInput = "";
        }
    }

    private async Task GoToSignup()
    {
        await OnGoToSignup.InvokeAsync();
    }
}